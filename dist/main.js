(()=>{"use strict";class e{UiSelectors={board:"[data-board]",cell:"[data-cell]",counter:"[data-counter]",timer:"[data-timer]",resetButton:"[data-button-reset]",easyButton:"[data-button-easy]",normalButton:"[data-button-normal]",expertButton:"[data-button-expert]",modal:"[data-modal]",modalHeader:"[data-modal-header]",modalButton:"[data-modal-button]"};getElement(e){return document.querySelector(e)}getElements(e){return document.querySelectorAll(e)}}class t extends e{constructor(e,t){super(),this.x=e,this.y=t,this.value=0,this.isMine=!1,this.isReveal=!1,this.isFlagged=!1,this.selector=`[data-x="${this.x}"][data-y="${this.y}"]`,this.element=null}createElement(){return`<div class="cell border border--concave" data-cell data-x="${this.x}" data-y="${this.y}" ></div>`}toggleFlag(){this.isFlagged=!this.isFlagged,this.element.classList.toggle("cell--is-flag")}revealCell(){this.isReveal=!0,this.element.classList.remove("border--concave"),this.element.classList.add("border--revealed"),this.isMine?this.element.classList.add("cell--is-mine"):this.value&&(this.element.textContent=this.value,this.element.classList.add(`cell--info-${this.value}`))}addMine(){this.isMine=!0}}class s extends e{value=null;#e=null;init(){this.#e=this.getElement(this.UiSelectors.counter)}setValue(e){this.value=e,this.#t()}increment(){this.value++,this.#t()}decrement(){this.value--,this.#t()}#t(){this.#e.textContent=this.value}}class i extends e{#e=null;#s=null;numberOfSeconds=0;maxNumberOfSeconds=999;init(){this.#e=this.getElement(this.UiSelectors.timer)}#i(){this.#s=setInterval((()=>this.#l()),1e3)}stopTimer(){clearInterval(this.#s)}resetTimer(){this.numberOfSeconds=0,this.#n(this.numberOfSeconds),this.stopTimer(),this.#i()}#l(){this.numberOfSeconds++,this.numberOfSeconds<=this.maxNumberOfSeconds?this.#n(this.numberOfSeconds):this.stopTimer()}#n(e){this.#e.textContent=e}}class l extends e{element=this.getElement(this.UiSelectors.resetButton);changeEmotion(e){this.element.querySelector("use").setAttribute("href",`./assets/sprite.svg#${e}`)}}class n extends e{buttonText="";infoText="";element=this.getElement(this.UiSelectors.modal);button=this.getElement(this.UiSelectors.modalButton);header=this.getElement(this.UiSelectors.modalHeader);toggleModal=()=>{this.element.classList.toggle("hide")};setText(){this.header.textContent=this.infoText,this.button.textContent=this.buttonText}}class a extends e{#a={easy:{rows:8,cols:8,mines:10},normal:{rows:16,cols:16,mines:40},expert:{rows:16,cols:30,mines:99}};#o=new s;#r=new i;#h=new n;#m=!1;#d=null;#c=null;#u=null;#g=[];#f=null;#b=0;#v=0;#C=null;#x={modal:null,easy:null,normal:null,expert:null,reset:new l};initializeGame(){this.#E(),this.#o.init(),this.#r.init(),this.#M(),this.#w()}#E(){this.#C=this.getElement(this.UiSelectors.board),this.#x.modal=this.getElement(this.UiSelectors.modalButton),this.#x.easy=this.getElement(this.UiSelectors.easyButton),this.#x.normal=this.getElement(this.UiSelectors.normalButton),this.#x.expert=this.getElement(this.UiSelectors.expertButton)}#w(e=this.#a.easy.rows,t=this.#a.easy.cols,s=this.#a.easy.mines){this.#d=e,this.#c=t,this.#u=s,this.#o.setValue(this.#u),this.#r.resetTimer(),this.#b=this.#c*this.#d-this.#u,this.#x.reset.changeEmotion("neutral"),this.#m=!1,this.#v=0,this.#O(),this.#p(),this.#y(),this.#S(),this.#f=this.getElements(this.UiSelectors.cell),this.#T()}#L(e){if(this.#m=!0,this.#r.stopTimer(),this.#h.buttonText="Close",!e)return this.#k(),this.#h.infoText="You lost, try again",this.#x.reset.changeEmotion("negative"),this.#h.setText(),void this.#h.toggleModal();this.#h.infoText=this.#r.numberOfSeconds<this.#r.maxNumberOfSeconds?`You won! It took tou ${this.#r.numberOfSeconds}seconds. Congratulations!`:"You won, congratulations!",this.#h.setText(),this.#h.toggleModal(),this.#x.reset.changeEmotion("positive")}#p(){this.#g.length=0;for(let e=0;e<this.#d;e++){this.#g[e]=[];for(let s=0;s<this.#c;s++)this.#g[e].push(new t(s,e))}}#T(){this.#f.forEach((e=>{e.addEventListener("click",this.#G),e.addEventListener("contextmenu",this.#R)}))}#B(){this.#f.forEach((e=>{e.removeEventListener("click",this.#G),e.removeEventListener("contextmenu",this.#R)}))}#M(){this.#x.modal.addEventListener("click",this.#h.toggleModal),this.#x.easy.addEventListener("click",(()=>{this.#F(this.#a.easy.rows,this.#a.easy.cols,this.#a.easy.mines)})),this.#x.normal.addEventListener("click",(()=>{this.#F(this.#a.normal.rows,this.#a.normal.cols,this.#a.normal.mines)})),this.#x.expert.addEventListener("click",(()=>{this.#F(this.#a.expert.rows,this.#a.expert.cols,this.#a.expert.mines)})),this.#x.reset.element.addEventListener("click",(()=>{this.#F()}))}#F(e=this.#d,t=this.#c,s=this.#u){this.#B(),this.#w(e,t,s)}#y(){for(;this.#C.firstChild;)this.#C.removeChild(this.#C.lastChild);this.#g.flat().forEach((e=>{this.#C.insertAdjacentHTML("beforeend",e.createElement()),e.element=e.getElement(e.selector)}))}#S(){let e=this.#u;for(;e;){const t=this.#U(0,this.#d-1),s=this.#U(0,this.#c-1),i=this.#g[t][s];i.isMine||(i.addMine(),e--)}}#G=e=>{const t=e.target,s=parseInt(t.getAttribute("data-y"),10),i=parseInt(t.getAttribute("data-x"),10),l=this.#g[s][i];this.#I(l)};#R=e=>{e.preventDefault();const t=e.target,s=parseInt(t.getAttribute("data-y"),10),i=parseInt(t.getAttribute("data-x"),10),l=this.#g[s][i];if(!l.isReveal&&!this.#m)return l.isFlagged?(this.#o.increment(),void l.toggleFlag()):void(this.#o.value&&(this.#o.decrement(),l.toggleFlag()))};#I(e){this.#m||e.isFlagged||e.isReveal||(e.isMine&&this.#L(!1),this.#V(e),this.#v!==this.#b||this.#m||this.#L(!0))}#k(){this.#g.flat().filter((({isMine:e})=>e)).forEach((e=>e.revealCell()))}#V(e){let t=0;for(let s=Math.max(e.y-1,0);s<=Math.min(e.y+1,this.#d-1);s++)for(let i=Math.max(e.x-1,0);i<=Math.min(e.x+1,this.#c-1);i++)this.#g[s][i].isMine&&t++;if(e.value=t,e.revealCell(),this.#v++,!e.value)for(let t=Math.max(e.y-1,0);t<=Math.min(e.y+1,this.#d-1);t++)for(let s=Math.max(e.x-1,0);s<=Math.min(e.x+1,this.#c-1);s++){const e=this.#g[t][s];e.isReveal||this.#I(e)}}#O(){document.documentElement.style.setProperty("--cells-in-row",this.#c)}#U(e,t){return Math.floor(Math.random()*(t-e+1)+e)}}window.onload=function(){(new a).initializeGame()}})();